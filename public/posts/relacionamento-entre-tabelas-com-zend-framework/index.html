<!--
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

- -->
<!--
- -----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

- - -->
<!--
- - -----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

- - - -->
<!--
- - - -----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

- - - - -->
<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="shrink-to-fit=no,width=device-width,height=device-height,initial-scale=1,user-scalable=1"><meta name=description content="My corner of the web"><title>Adler Medrado's little piece of turf</title>
<link rel=author href=/humans.txt><link rel=canonical href=https://adlermedrado.com.br><link href=/css/styles.css rel=stylesheet></head><body><header><nav class=navbar role=navigation><div class=navbar_left><a href=/><strong>Adler Medrado</strong></a></div><div class=navbar_right><a href=/posts>Posts</a>
<a href=/tags>Posts by Tags</a></div></nav></header><main><section class=section><article><div><h1>Relacionamento entre tabelas com Zend Framework</h1><div><div><p><small><time>March 25, 2008</time>
|
4 minutes read</small></p></div><span class=line_break></span></div><div class=content><p>O Zend Framework possui uma camada de modelo, composta por algumas classes
como <code>Zend_Db</code>, <code>Zend_Db_Table</code>, <code>Zend_Db_Table_Rowset</code>, entre outras, e é muito simples criar uma classe que representa
uma determinada tabela, basta herdar da classe <code>Zend_Db_Table_Abstract</code> que você terá todos os métodos principais de
acesso à dados, como insert, update, etc.</p><p>Porém as tabelas possuem relacionamentos e uma entidade em uma tabela pode ser ligada a uma ou mais entidades em outra
tabela utilizando integridade referencial, e o Zend Framework permite que você faça isso tudo no nível de objeto através
de métodos específicos da classe <code>Zend_Db_Table_Row</code>.</p><p>Para demonstrar isso, vou usar como exemplo uma relação bem simples. Supondo que existam as seguintes tabelas:</p><pre tabindex=0><code>UF
id - INT - PRIMARY KEY
nome - Varchar(100)

CIDADE
id - INT - PRIMARY KEY
nome - Varchar(100)
uf_id - INT - FOREIGN KEY
</code></pre><p>Se criarmos duas classes no Zend Framework para representar essas tabelas, nós faríamos o seguinte:</p><pre tabindex=0><code>class UF extends Zend_Db_Table_Abstract
{
    protected $_name = &#34;uf&#34;;
}

class Cidade extends Zend_Db_Table_Abstract
{
    protected $_name = &#34;cidade&#34;;
}
</code></pre><p>Com essas duas classes nós já possuímos os métodos necessários para inserir, alterar, excluir e recuperar os dados
delas, porém, de maneira independente. Para recuperarmos todas as cidades de um determinado estado por exemplo, nós
poderíamos fazer o seguinte:</p><p>Primeiro, uma pequena alteração nas classes:</p><pre tabindex=0><code>class UF extends Zend_Db_Table_Abstract
{
    protected $_name = &#34;uf&#34;;
    protected $_dependentTables = array(&#39;Cidade&#39;);
}

class Cidade extends Zend_Db_Table_Abstract
{
    protected $_name = &#34;cidade&#34;;
    protected $_referenceMap = array(
        &#39;UF&#39; =&gt; array(
            &#39;columns&#39; =&gt; &#39;uf_id&#39;,
            &#39;refTableClass&#39; =&gt; &#39;UF&#39;,
            &#39;refColumns&#39; =&gt; &#39;id&#39;
        )
    );
}
</code></pre><p><strong>Calma, já vou explicar:</strong></p><p>Na propriedade da classe UF <code>$_dependantTables</code>, eu defino quais tabelas/classes que são dependentes da tabela UF,
passando simplesmente o nome da classe como um elemento de um array. Pode-se passar quantos nomes de tabelas/classes
forem necessárias, desde que cada um seja um elemento distinto.</p><p>Na propriedade da classe Cidade <code>$_referenceMap</code>, nós fazemos o mapeamento entre as duas classes, onde a coluna <code>uf_id</code>
da tabela Cidade é uma referência ao campo id da tabela UF. Simples demais!</p><p>Vamos testar?</p><p>Eu vou mostrar duas maneiras diferentes para retornar todas as cidades de uma determinada UF, a primeira segue abaixo:</p><p>PS: Eu vou criar um IndexController para executar este exemplo.</p><pre tabindex=0><code>include_once &#39;UF.php&#39;;
include_once &#39;Cidade.php&#39;;

class IndexController extends Base_Controller_Action
{
    public function indexAction()
    {
        // Cria instância da classe UF
        $tabelaUF = new UF();
        
        // Pesquisa pelo UF 1 (1 é o ID do UF na tabela UF)
        $ufRows = $tabelaUF-&gt;find(1);
        
        // Retorna o Zend_Db_Table
        $uf = $ufRows-&gt;current();
        
        // Pesquisa pelas cidades referentes ao UF consultado acima
        $cidadesPorUF = $uf-&gt;findDependentRowset(’Cidade’);
        
        // Mostra resultado
        echo ‘&lt;pre&gt;’;
        print_r($cidadesPorUF);
        echo ‘&lt;/pre&gt;’;
    
    }
}
</code></pre><p>Simples não?</p><p>O Outro exemplo terá o mesmo resultado porém a maneira como consultaremos as cidades por dada UF será um pouco
diferente.
Se você está acostumado com PHP 5, você já conhece os chamados &lsquo;métodos mágicos&rsquo; como <code>__call()</code>, <code>__set()</code>, <code>__get()</code>
certo? pois então, agora nós vamos usar um método mágico chamado <code>FindCidadeByUF()</code> só que esse método não existe em
nossa classe, então de onde que ele veio? O Zend Framework possui um mecanismo que nos permite consultar tabelas
dependentes utilizando métodos mágicos no seguinte formato: <code>Find&lt;Tabela>By&lt;Tabela></code>, então ele dinamicamente saberá
onde consultar os dados, basta substituirmos a primeira pelo nome da classe Cidade e a segunda tabela pela
classe UF que ele se encarrega do resto.</p><p>Veja o exemplo:</p><pre tabindex=0><code>include_once &#39;UF.php&#39;;
include_once &#39;Cidade.php&#39;;

class IndexController extends Base_Controller_Action
{
    public function indexAction()
    {
        $tabelaUF = new UF();
        $ufRows = $tabelaUF-&gt;find(1);
        $uf = $ufRows-&gt;current();
        
        $cidadesPorUF = $uf-&gt;findCidadeByUF();
        
        echo ‘&lt;pre&gt;’;
        print_r($cidadesPorUF);
    }
}
</code></pre><p><strong>Considerações finais</strong></p><p>Espero ter conseguido demonstrar este mecanismo interessante do Zend Framework. Espero que da mesma forma com que ele
tem auxiliado o trabalho ele também auxilie o seu.</p><p><strong>O que que você achou? Deixe aqui seu comentário.</strong></p><p>A propósito, nos últimos dias alguns colegas me perguntaram bastante coisa sobre o Zend Framework, muitos queria fazer
um hello world para entender o padrão dele, outros queriam algo mais avançado, então eu pensei: Porque não escrever uma
série de tutoriais no meu blog? Isso pode ser útil para muito mais pessoas. Então gostaria de sua opinião. Deixe seu
comentário.</p><p>Eu estou pensando em fazer uma série de artigos simples e diretos ao assunto sobre Zend Framework, abordando desde o
básico até o mais avançado. Então, espero começar na próxima semana.</p><p>abraço.</p></div></div></article><div><div><div><a href=https://adlermedrado.com.br/posts/lehitraot-guterman/>&#8592; Lehitraot Guterman</a>
|
<a href=https://adlermedrado.com.br/posts/usabilidade/>Usabilidade &#8594;</a></div></div></div></section></main><span class=line_break></span>
<span class=line_break></span><footer><div><p><small>&copy; 1996-2023 Adler Medrado</small></p></div><div class=gpg_signed_info><p>All pages on this website are PGP signed.
Import my <a href=/pub-key.asc>public key</a> and check with <em>curl https://adlermedrado.com.br/posts/relacionamento-entre-tabelas-com-zend-framework/ | gpg --verify</em></p></div></footer></body></html><!--
- - - -----BEGIN PGP SIGNATURE-----

iQIzBAEBCAAdFiEEOakOfYA7XALT7+un/2dtxSoBkcMFAmWRhTAACgkQ/2dtxSoB
kcMWgg/+OMPunNMLT+pT9o2ostFTmYuyKh8iCgdJ5MdQUDC8UlRNeVKWAnoGtx+O
KU0IFewBdkasZHHYr43cCIC+JBOD5l/9VGUqnn32rYEURQBRF7ieETC8tpby3N+7
OCogP6zZj5UeyDs2AFnRyCQ2MhwDN1oL9eXx1oEEjhZKafSWFoXbk3mwhVLA8LgN
qY3dKir5zCXmB0ENuhGLhM8hD04Tcy6S38AfDqFisCUeZyqpghlyCHs7h9ccczz0
YRPS4CAnBPkExsmF3E6d4Jmliv4UtcqCwajx6wVd7kvgCQBpDAtToCpwsVF6iZdi
wRUFo+IjsnYRPmQFeIpK6usXtvLPyWyILnXLkS57K1IVCeKsGgqt9WljcZQbpQ/o
SVW0wEGDqmtT9/g5eN62z/aO8BpRbvXKtiQWb3rgCF/XX4l8CNahi9W4vbQ+4wfE
WplFZiH3sGpkGic1Q5N58+n+FT6hZ5GHynsX4KAO/RZhXjgwEHYmnxH2XYvRckLV
Rf0su/jhAD55ATwxdK++Fz3CVCQwyF5pDnQRY21T+9RUCuXdNNWUSoxqlbAyiyMh
9srx/T0pI9DK6payFhpZhKbQY6hh60SRGFRMIAd+QE89K87BO6ADiNMjUge4ZRpp
b3urEq89AH/AAB90WJ7eYSyQCNSUCBHXTOI3u9Gpukrd1OCDX3s=
=IecS
- - - -----END PGP SIGNATURE-----
- - - -->
<!--
- - -----BEGIN PGP SIGNATURE-----

iQIzBAEBCAAdFiEEOakOfYA7XALT7+un/2dtxSoBkcMFAmWRjxgACgkQ/2dtxSoB
kcNK/xAAmJZJPGSMcP2kA3zcU+enUiYov3Yy+L4cONh+BDdCXDtV3XnU01Jms7aN
68cSgvOPEA2vaQ+3+uLyDUYQ/M3bFX5wshTaLyJqtXOHCbcOYgpRvyejrUJsNDgn
8VQijADcEH45Zp1waC4GQHJqhteJW407ymaDoYto/8pSLp7az0HLVUvffnUk/LcQ
Co2lUJnhvESxSMnFZsSLJOGTNpFRMxFbuQc4HOAm8/VONYc+DpyhrZ5T+imfib7D
DbhQ1VD7rsKmMLtjVjal5FEezk1v/OOAlPJLz5sv9U0F4wsEDtvyvioSULjHcCSU
qR4d4WamDMbx56MD7mSbrQdMZW4p4GSIqibg6pj9U7RqnfhV6u7bpBBoVCQQQ3lP
Esh8GDWBz/Mqd3PxzuDeJzMaEU7f48OYyljWHriwslpNFo8UWpdGRZg4X8Ybx78d
qv2QaWYQrIF0wBdIZ8RqqJMfwzGmy78IYdw7LSGCYBYhpjzHc9GxAONFY2vzzXSU
ExsaFPjX7AB9v5fV3rUhbbidYxsiztjgVp1OMpUkuoZu1hYmA3jJthtC2xkO+8fb
kMU7MA118zsuVAEPgreS7QJKW1ottT4FA8qTTP270u+YoE8ZGzUI91XqOdCHm4B+
JRJU2BLlm90WpXowgqsuQZYZK/WlsRorYjnLvhWQqwsaKAsUkBw=
=MSoR
- - -----END PGP SIGNATURE-----
- - -->
<!--
- -----BEGIN PGP SIGNATURE-----

iQIzBAEBCAAdFiEEOakOfYA7XALT7+un/2dtxSoBkcMFAmWRj+wACgkQ/2dtxSoB
kcO0qRAAkwZeumo0apXJDts/aSBWsYhTr2ZfUooR0FlUUfmFf6ZnxT5YKK5HWdFW
xbTCNifZ+Xg0DP7Zbq8uRHVNgbYFf99mouAifRIKRpDHoEBUxANhkj3ACMtS7por
e4YxjSF2E5YBmQKO/6ywsSY6yUtVbE5AzL3ctSz52NLrnmfGc/gtgE4Bx/avLT5S
1TXfDnQfiykFub3q6RxNr9+57ldtm6J2sY3sIVgW7u2x01aYm+7p6k0SOk8QyCmy
ZGCMoKaBOoXIEjB7lukw13JYajxIsP6lZbcIuvBbL7qELQpjsR2Z3lXQggoV+UrM
KK0oObQz++QzpUtTrjaKbWhJTxHrjjKtHkfxqduCvw/7ywC5ze8mFMM/vdNLVdWb
g3IWu21MuBM8tIjUVkBaT+rAM1QdlGwOEcx/6mLBgGK17yrCGgiwTMElyD1AS5Zz
2A6tcGSib7GBeXwfCTOmpJNn+4yr9ayCTpyWssL6b7+c6nvFXqkulrOBsbfAKU/g
9Te+exfeWbSgYnV3msmrtxWJgNqkYk3+UoA5Zw6e3Dhy1VjRXCZN6biwXkuPCmoU
nYVGT04OdgBYobFUsQFUYE9lhwExXguMYMLSfGbFXucjbWOdkDDzu+tUhNr2X/b9
dv2ygaMFWTRg+nbm6G4AtBCUqTYdmPSllqhDDOeNUeJzj3+OvKs=
=b+fx
- -----END PGP SIGNATURE-----
- -->
<!--
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCAAdFiEEOakOfYA7XALT7+un/2dtxSoBkcMFAmWRlIMACgkQ/2dtxSoB
kcPIwRAAvON45f+f99XEU1LhL81G2DY149hzrbjV46GLlWQuOgneHNDOVya/K8dS
3oxhYz7tJfzNTr59OllwI6XfT7sQvoCD5rRVuiwGZiydbCdeKoa0GBno7XjB4nK/
o2eSSNXhPQ3/HsTVKpDa+Yt8S5Y8iN+heTU+BtEkKX8j+io9hZYRLPyLWPY+Y6WF
p7had7msl3lS+8cAjbaIlENBrid5JhqQ7x/tiXfpufb++uEZX9pIcAfdBqPp+XR2
t2VcgvOq5qbEV5dWjkMCNrmEPDYbguKne4Jx9BJEU5TDC2VXubgsqxWN4Y1xsL+j
BRtdn/hVP0gOvs1eukBX7bL/ZwoYSDbM0F6PHzeb7zjDS2BNWX5YCVZX3EeUhVty
fya2NKv7ij0sO0TL+itW3i4nMqlsNIVxa6fPztvJBpaHvVwH39IZ3VG9cpv9iynj
wDDMFCUgkrGaGRd2xrMgAeTqMiy1lvo3powwlwus9k5G2jUSeaOUGhlUapDg1cQY
ZbaOQhviC3Ren8iPuRD9pt64n4z9K/Lboi07LEneCFPY0B2Gvh7RxUA4Fe4o44S4
HWqOtvbc+c2zsJfwpXW5UsmHmdI/ZzHzh4efsldvmhE+whvYaqGO+ZWsjAi5g+pY
zvYwbC3FGP8WyhFHnq6i0fvyDpkgYiaMMp7Pyr83K6BKB3jafKs=
=+JDY
-----END PGP SIGNATURE-----
-->
